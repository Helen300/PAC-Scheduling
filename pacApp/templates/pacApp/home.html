<!DOCTYPE HTML>
<!--
	Helios by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license
-->
<html>
	<head>
		<title>Princeton Dance</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="/static/pacApp/assets/css/schedule.css">
      	<link rel="stylesheet" href="static/pacApp/assets/css/table.css" />
      	<link rel="stylesheet" href="static/pacApp/assets/css/main.css" />
      	<script src="/static/pacApp/assets/js/input.js"></script> 
      	<script src="/static/pacApp/assets/js/schedule.js"></script> 
		<noscript><link rel="stylesheet" href="static/pacApp/assets/css/noscript.css" /></noscript>
	</head>
	<body class="homepage is-preload">
		<div id="page-wrapper">
			<!-- Header -->
				<div id="header">
					<!-- Inner -->
						<div class="inner">
							<header>
								<h1><a href="templates/pacApp/home.html" id="logo">Princeton Dance</a></h1>
								<hr />
								<p>Rehearsal spaces and availability</p>
							</header>
							<footer>
								<a href="#banner" class="button circled scrolly">Start</a>
							</footer>
						</div>

					<!-- Nav -->
						<nav id="nav">
							<ul>
								<li><a href="#">Home</a></li>
								<li>
									<a href="#">What's Open</a>
									<ul>
										<li><a href="schedule">Schedule</a></li>
										<li><a href="#">Magna phasellus</a></li>
										<li><a href="#">Etiam dolore nisl</a></li>
										<li>
											<a href="#">And a submenu &hellip;</a>
											<ul>
												<li><a href="#">Lorem ipsum dolor</a></li>
												<li><a href="#">Phasellus consequat</a></li>
												<li><a href="#">Magna phasellus</a></li>
												<li><a href="#">Etiam dolore nisl</a></li>
											</ul>
										</li>
										<li><a href="#">Veroeros feugiat</a></li>
									</ul>
								</li>
								<li><a href="#">PAC</a>
									<ul>
										<li><a href="#">PAC Login</a></li>
										<li><a href="adminForm">PAC Form</a></li>
									</ul>
								</li>
							</ul>
						</nav>
				</div>

			<!-- Banner -->
				<section id="banner">
					<header>
						<h2> Princeton is home to <strong> twelve dance spaces </strong> <br/> open to everyone</h2>
						<p>
							Below we provide the full list of their details and availability.
						</p>
					</header>
				</section>

			<!-- Table -->
			{% include 'templates/pacApp/schedule.html' %}

			<!-- Carousel -->
				<section id="second">
					<header>
						<br>
						<h2 style="text-align:center; padding=30px"> Looking for a studio ? <br>
							<strong> Dance spaces open right now.</strong> </h2>

					</header>
				</section>
			{% include 'templates/pacApp/carousel.html' %}

				<section>

					<!-- <form action="{% url 'insert_space_item' %}" method="POST" autocomplete="=off">
						{% csrf_token %}
						<div class="input-gtoup">
							Company_Name: <input type="text" class="form-control" name="company_name"> <br>
							Time_Start: <input type="text" class="form-control" name="time_start"><br>
							Time_End: <input type="text" class="form-control" name="time_end"><br>
							Studio: <input type="text" class="form-control" name="studio"><br>
							<div class="input-group-append text-info">
								<span class="input-grou-text bg-white py-0">
									<button type="submit" class="btn btn-sm text-info">
										<i class="fa fa-plus-circle fa-lg">
										</i>
										Post
									</button>
								</span>
							</div>
						</div>
					</form>
					Results of DB:
					<ul class="list-group">
						{% for item in space_list %}
						<li class="list-group-item">{{item.company_name}}{{item.time_start}}{{item.time_end}}{{item.studio}}</li>
						{% endfor %}
					</ul> -->
				</section>
			<!-- Main -->
				<div class="wrapper style2">

					<article id="main" class="container special">
						<a href="#" class="image featured"><img src="static/pacApp/images/pic06.jpg" alt="" /></a>
						<header>
							<h2>Where is my dance rehearsal?</h2>
							<p>
								Here's our map with the locations of all the rehearsal spaces around Princeton!
							</p>
						</header>
						<!-- 
						<footer>
							<a href="#" class="button">Continue Reading</a>
						</footer>
						--->
					</article>

				</div>

			<!-- Features -->
				<div class="wrapper style1">

					<section id="features" class="container special">
						<header>
							<h2>Our Team</h2>
							<p> The amazing people that brought this project to life!</p>
						</header>
						<div class="row">
							<article class="col-4 col-12-mobile special">
								<a href="#" class="image featured"><img src="static/pacApp/images/pic07.jpg" alt="" /></a>
								<header>
									<h3><a href="#">Nicole Meister</a></h3>
								</header>
								<p>
									What ann Amazing person!!!!
								</p>
							</article>
							<article class="col-4 col-12-mobile special">
								<a href="#" class="image featured"><img src="static/pacApp/images/pic07.jpg" alt="" /></a>
								<header>
									<h3><a href="#">Edward Tian</a></h3>
								</header>
								<p>
									That's me!!!!
								</p>
							</article>
							<article class="col-4 col-12-mobile special">
								<a href="#" class="image featured"><img src="static/pacApp/images/pic08.jpg" alt="" /></a>
								<header>
									<h3><a href="#">Helen Ellen Melon</a></h3>
								</header>
								<p>
									Supperrrr coool Person!!!!
								</p>
							</article>
							<article class="col-4 col-12-mobile special">
								<a href="#" class="image featured"><img src="static/pacApp/images/pic09.jpg" alt="" /></a>
								<header>
									<h3><a href="#">Angela Li<LInk:rss></LInk:rss></a></h3>
								</header>
								<p>
									Anottherrr Amazzzing Person!
								</p>
							</article>
						</div>
					</section>

				</div>

			<!-- Footer -->
				<div id="footer">
					<div class="container">
						<div class="row">
							<div class="col-12">
								<!-- Contact -->
									<section class="contact">
										<header>
											<h3>Contact: pacpps@princeton.edu</h3>
										</header>
									</section>
								<!-- Copyright -->
									<div class="copyright">
										<ul class="menu">
											<li>&copy; PAC Dance. All rights reserved.</li><li>Design: <a href=>edwardtian</a></li>
										</ul>
									</div>
							</div>

						</div>
					</div>
				</div>

		</div>

		<!-- Scripts -->
			<script src="static/pacApp/assets/js/jquery.min.js"></script>
			<script src="static/pacApp/assets/js/jquery.dropotron.min.js"></script>
			<script src="static/pacApp/assets/js/jquery.scrolly.min.js"></script>
			<script src="static/pacApp/assets/js/jquery.scrollex.min.js"></script>
			<script src="static/pacApp/assets/js/browser.min.js"></script>
			<script src="static/pacApp/assets/js/breakpoints.min.js"></script>
			<script src="static/pacApp/assets/js/util.js"></script>
			<script src="static/pacApp/assets/js/main.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

   <script>
   		// for getting the week number of a given date 
		 Date.prototype.getWeekNumber = function() { 
  
            var oneJan =  
                new Date(this.getFullYear(), 0, 1); 
  
            // calculating number of days  
            //in given year before given date 
  
            var numberOfDays =  
                Math.floor((this - oneJan) / (24 * 60 * 60 * 1000)); 
  
            // adding 1 since this.getDay() 
            //returns value starting from 0 
  
            return Math.ceil((this.getDay() + 1 + numberOfDays) / 7); 
  
        } 
	
        // setting up the week selector function 
         function activateDay()
         {  // getting today's date
            let today = new Date();
            // getting the day of week for today
            // returned as integers, 0 = sunday, 6 = saturday
            let todayDay = today.getDay();
            let todayWeek = today.getWeekNumber(); 
            // console.log(todayWeek);
            // creating the id descriptor
            let selectTab = '#d' + todayDay;
            // adding a class to element with id d(todayDay)
            let weekValue = today.getFullYear() + '-W' + todayWeek;
            let formattedDate = buildDate(today);
            // $('#currweek').val(weekValue);
            // sets the value for the date picker default 
            $('#curr').val(formattedDate);
            // set a field called data-week to be the week number 
            $('#curr').attr('data-week', weekValue);
            // to retrieve that data value use .data('nameofdata')
            // console.log($('#curr').data('week'));
            // sets up the week initially 
            setupWeek(false);
         }

         function parse() {
         	 var wilcox = [
    // we passed in a context argument which is a list containing
    // an element called 'Wilcox'
    // Wilcox value is a list of bookings 
    {% for booking in Wilcox %}
        { // for each of the booking, create a new object booking with such fields
         company_name:"{{booking.company_name}}",
         start_time:"{{booking.start_time}}",
         end_time:"{{booking.end_time}}",
         studio:"wilcox",
         week_day:"{{booking.week_day}}",
         booking_date:"{{booking.booking_date}}"
        },
    {% endfor %}
   ];

    var bloomberg = [
    {% for booking in Bloomberg %}
        {
         company_name:"{{booking.company_name}}",
         start_time:"{{booking.start_time}}",
         end_time:"{{booking.end_time}}",
         studio:"bloomberg",
         week_day:"{{booking.week_day}}",
         booking_date:"{{booking.booking_date}}"
        },
    {% endfor %}
   ];

  var dilliondance = [
    {% for booking in DillionDance %}
        {
         company_name:"{{booking.company_name}}",
         start_time:"{{booking.start_time}}",
         end_time:"{{booking.end_time}}",
         studio:"dilliondance",
         week_day:"{{booking.week_day}}",
         booking_date:"{{booking.booking_date}}"
        },
    {% endfor %}
   ];

   var dillionmpr = [
    {% for booking in DillionMPR %}
        {
         company_name:"{{booking.company_name}}",
         start_time:"{{booking.start_time}}",
         end_time:"{{booking.end_time}}",
         studio:"dillionmpr",
         week_day:"{{booking.week_day}}",
         booking_date:"{{booking.booking_date}}"
        },
    {% endfor %}
   ];

   var roberts = [
    {% for booking in Roberts %}
        {
         company_name:"{{booking.company_name}}",
         start_time:"{{booking.start_time}}",
         end_time:"{{booking.end_time}}",
         studio:"roberts",
         week_day:"{{booking.week_day}}",
         booking_date:"{{booking.booking_date}}"
        },
    {% endfor %}
   ];

   var murphy = [
    {% for booking in Murphy %}
        {
         company_name:"{{booking.company_name}}",
         start_time:"{{booking.start_time}}",
         end_time:"{{booking.end_time}}",
         studio:"murphy",
         week_day:"{{booking.week_day}}",
         booking_date:"{{booking.booking_date}}"
        },
    {% endfor %}
   ];

    var ns = [
    {% for booking in NewSouth %}
        {
         company_name:"{{booking.company_name}}",
         start_time:"{{booking.start_time}}",
         end_time:"{{booking.end_time}}",
         studio:"ns",
         week_day:"{{booking.week_day}}",
         booking_date:"{{booking.booking_date}}"
        },
    {% endfor %}
   ];

    var forbes = [
    {% for booking in Forbes %}
        {
         company_name:"{{booking.company_name}}",
         start_time:"{{booking.start_time}}",
         end_time:"{{booking.end_time}}",
         studio:"forbes",
         week_day:"{{booking.week_day}}",
         booking_date:"{{booking.booking_date}}"
        },
    {% endfor %}
   ];

    var ellie = [
    {% for booking in Ellie %}
        {
         company_name:"{{booking.company_name}}",
         start_time:"{{booking.start_time}}",
         end_time:"{{booking.end_time}}",
         studio:"ellie",
         week_day:"{{booking.week_day}}",
         booking_date:"{{booking.booking_date}}"
        },
    {% endfor %}
   ];
   
   		var list = {'wilcox':wilcox, 'bloomberg': bloomberg, 'dilliondance': dilliondance,
   		'dillionmpr': dillionmpr, 'roberts': roberts, 'murphy': murphy, 'ns': ns, 'forbes': forbes, 
   		'ellie':  ellie
         };
        
       return list;
   }

         function setupWeek(update)
         	// date = yyyy-mm-dd
       	{
       		// in prepation for the today tab - if it is on the current day, has this feature 
       		var actualDate = new Date();
       		var actualweek = actualDate.getWeekNumber();
       		var actualDay = actualDate.getDay();
       		let selectTab = '#d' + actualDay;
       		
       		
       		var currweek = $('#curr').data('week');
       		var curr = $('#curr').val();
       		// var curr = $('#curr').val(date)
       		// console.log(curr);
       		var year = parseInt(curr.slice(0,4));
       		// need to subtract 1 from month because months start indexing at 0
       		var month = parseInt(curr.slice(6,8))-1;
       		var date = parseInt(curr.slice(curr.length-2));
       		// console.log(date);
       		var currDate = new Date(year, month, date);
       		// console.log(currDate.getWeekNumber())
       		if (currDate.getWeekNumber() != actualweek) {
       			$(selectTab).removeClass('today');
       		}
       		else {
       			$(selectTab).addClass('today');
       		}
       		// console.log(currDate);
       		var currDay = currDate.getDay();
       		var daysofweek = ['sun','mon','tue','wed','thu','fri','sat'];

       		openDay(daysofweek[currDay],'d'+ currDay);
       		var id = '#d' + currDay;
       		// $(id).addClass('today');
       		// console.log(currDay);
       		
       		// use .data('name of data', value) to set the data-key = value 
       		$(id).data('date', currDate);
       		// console.log($(id).data('date'));
       		for (var i = 0; i < 7; i++) {
       			var d = new Date(year, month, date); 
       			d.setDate(d.getDate() + i);
       			// console.log(d);
       			var idnew = '#d' + d.getDay();
       			// need to use .data to set the field as well 
       			$(idnew).data('date',d);
       		}
       		// console.log(update)
       		if (update) {
       			let url = '';
       			request = $.ajax(
               {
                  type: "GET",
                  url: url,
                  data: {'newdate': curr},
                  success: handleweekchange(),
               }
            );
       		}
       		// TESTING---------------------------------------
       		/* CONFIRMS THAT THE CORRECT DATES HAVE BEEN SET 
       		for (var j = 0; j < 7; j++) {
       			console.log($('#d'+j).data('date'));
       		} */
       		// console.log($(id).data('date'));
       		// console.log(currDate);
       		// console.log(currDate.toDateString());
       		// console.log(currday.slice(currday.length-2));
			// console.log(currweek);

			/* if (day >= date.getDay()) {
				currdate = date.getDate();
			date.setDate(currdate + (day - date.getDay()));
			console.log(date);
			}
			else {
				currdate = date.getDate();
				date.setDate(currdate + (7 - date.getDay()) + day);
				console.log(date);
			} */ 
       	}

       	function handleweekchange() {
       		var data = parse();
       		for (var i in data) {
       			console.log(data[i])
       		}
       		schedule(data);
       		// $('document').load('templates/pacApp/schedule.html');
       		console.log('success after week update');

       	}

         function setup()
         { 
         	
            activateDay();
            var data = parse();
            schedule(data);

         }
         $('document').ready(setup);
   </script>


	</body>
</html>